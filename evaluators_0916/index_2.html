<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Trust Judgement Task</title>


  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>

  <style>
    :root {
      --bg-light: #f5f5f5;
      --bg-dark: #0a0a0a;
      --card-light: #fff;
      --card-dark: #1e1e1e;
      --text-light: #333;
      --text-dark: #e6eef8;
      --muted-light: #666;
      --muted-dark: #9aa6bf;
      --accent: #6ee7b7;
      --accent-2: #60a5fa;
      --glass-light: rgba(255,255,255,0.9);
      --glass-dark: rgba(0,0,0,0.3);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    pre code {
      display: block;
      background-color: #f5f5f5;
      color: #333;
      padding: 12px;
      border-radius: 6px;
      font-family: Consolas, Monaco, "Courier New", monospace;
      font-size: 14px;
      overflow-x: auto;
    }

    body.light { background: var(--bg-light); color: var(--text-light); }
    body.dark { background: var(--bg-dark); color: var(--text-dark); }

    .container { max-width: 1960px; margin: 4px auto; padding: 20px; }
    .panel { background: var(--glass-light); border-radius: 12px; padding: 18px;
             box-shadow: 0 6px 24px rgba(2,6,23,0.1); border: 1px solid rgba(0,0,0,0.05); }
    body.dark .panel { background: var(--glass-dark); border: 1px solid rgba(255,255,255,0.03); }

    .controls{display:flex;gap:12px;align-items:center}
    select,input[type=number]{background:transparent;border:1px solid rgba(0,0,0,0.1);
      padding:8px 10px;border-radius:8px;color:inherit}
    button.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));border:none;
      padding:9px 14px;border-radius:10px;font-weight:600;cursor:pointer;color:#04202a}
    button.ghost{background:transparent;border:1px solid rgba(0,0,0,0.1);
      padding:8px 12px;border-radius:10px;color:var(--muted-light);cursor:pointer}

    .instruction{margin-top:12px;font-size:14px;line-height:1.5;color:var(--muted-light)}

    .quiz-area{margin-top:18px}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .question-box{
      background: var(--card-light); padding:16px; border-radius:10px; border:1px solid #ddd;
      min-height:110px; max-width: 900px; margin: 0 auto;
    }
    body.dark .question-box { background: var(--card-dark); border:1px solid rgba(255,255,255,0.03); }
    #answersRow {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 20px;
    }

    .answer-card {
      max-width: 900px;
      width: 100%;
    }

    .qtext{font-size:15px;line-height:1.6}
    .answer-card{flex:1 1 0; background:var(--card-light); padding:12px; border-radius:10px;
      border:1px solid #ddd; max-width:1000px;}
    body.dark .answer-card{background:var(--card-dark);border:1px solid rgba(255,255,255,0.03);}
    .ans-text{overflow:auto;font-size:14px;padding-bottom:8px;max-height: 450px; overflow-y: auto;}
    .ans-controls{display:flex;gap:8px;align-items:center;justify-content:center;margin-top:12px}
    .btn-choose{flex:1;padding:8px 10px;border-radius:8px;border:1px solid rgba(0,0,0,0.1);
      background:transparent;cursor:pointer}
    .btn-choose.selected.trust{background:rgba(102,255,204,0.12);border-color:rgba(102,255,204,0.18);color:var(--accent)}
    .btn-choose.selected.not{background:rgba(255,102,102,0.06);border-color:rgba(255,100,100,0.12);color:#ff9ea0}

    .controls-row{display:flex;gap:12px;align-items:center; margin-top:14px; width: 900px; max-width: 900px; justify-content: center;}
    .progress{font-size:13px;color:var(--muted-light)}
    .timer{font-weight:700;background:rgba(207, 49, 49, 0.05);padding:6px 10px;border-radius:8px;
      border:1px solid rgba(163, 68, 68, 0.1);font-size:30px; position: absolute; top: 10px; right: 20px; width:250px; text-align: center;}
    .hidden{display:none}
  </style>

  <!-- MathJax -->
  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(','\\)'], ['$','$']], displayMath: [['\\[','\\]']], processEscapes: true },
      options: { skipHtmlTags: ['script','noscript','style','textarea','pre'] },
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body class="light">
  <div class="container">
    <div class="panel" id="topbar">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
        <div class="controls">
          <select id="datasetSelect" style="visibility: hidden; width: 0;"></select>
          <label class="sub">Questions:</label>
          <input id="qcount" type="number" min="1" max="240" value="150" style="width:50px">
          <button id="startBtn" class="primary">Start</button>
          <button id="resetBtn" class="ghost">Reset</button>
        </div>
        <div style="max-width:1200px">
          <div class="instruction" id="instruction">
            <strong>Instructions:</strong> You will be shown <b>one</b> question and <b>one</b> LLM answers. For <b>each</b> answer, quickly judge the <i>reasoning quality</i> — <u>not</u> the final result. A fast skim is enough.<br><br>

            Do <u>not</u> base your judgment on whether the final answer is correct — any or all answers may be wrong. <b>Important:</b> Each question can appear several times with any mix of correct and wrong answers—sometimes all answers are wrong, sometimes all answers are right, and anything in between. Judge each answer’s reasoning independently.<br><br>

            <b>Please go with your first instinct after seeing the full answer -  do not read line by line.</b> You have <b>20 seconds</b> per question and answer.<br><br>

            Choose <b>Trust</b> if the reasoning is coherent and step-by-step and has no major leaps or contradictions.<br>
            Choose <b>Don’t Trust</b> if the reasoning is vague or guess-based, contradicts itself or changes assumptions midstream, or justifies itself only by the final number.<br><br>

            <b>Remember:</b> Judge the <i>process</i>, not the result.<br>
            <i>A clear, sensible path to a wrong number/correct number → <b>Trust</b>.</i><br>
            <i>A shaky, lucky path to the right answer → <b>Don’t Trust</b>.</i>
          </div>
        </div>
      </div>
    </div>

    <div class="quiz-area hidden" id="quizArea">
      <div class="topbar">
        <div class="progress" id="progress">Round 0 / 0</div>
        <div style="position: fixed; top: 5px; right: 5px;">
          <div class="timer" id="timer">Time Left: 20s</div>
        </div>
      </div>

      <div class="question-box">
        <div class="qtext" id="qtext">Question will appear here</div>
      </div>

      <div class="answersRow" id="answersRow"></div>

      <div class="controls-row">
        <div><button id="nextBtn" class="primary" disabled>Next</button></div>
      </div>
    </div>
  </div>

  <script>
    const datasetSelect=document.getElementById("datasetSelect");
    const startBtn=document.getElementById("startBtn");
    const resetBtn=document.getElementById("resetBtn");
    const qcountInput=document.getElementById("qcount");

    let questions=[],answers=[];
    let chosenIndices=[],userChoices=[];
    let rounds=[],totalRounds=0,currentRound=0;
    let timerInterval=null,timeLeft=20;

    async function loadData(){
      const qres=await fetch("T_total/questions.json");
      const ares=await fetch("T_total/answers.json");
      questions=await qres.json(); answers=await ares.json();
    }

    function escapeDollar(text) {
        // let formulas = [];
        // text = text.replace(/\$(.+?)\$/g, (match, p1) => {
        //     formulas.push(match);
        //     return `@@FORMULA${formulas.length-1}@@`;
        // });

        // text = text.replace(/\$(?=\d)/g, "\\$");

        // text = text.replace(/@@FORMULA(\d+)@@/g, (match, idx) => formulas[idx]);

        return text;
    }    

    function extractQuestion(raw){
      if(!raw) return '';
      // const s=raw.replace(/\\r/g,'').trim();
      const s = raw.replace(/\r/g, '').trim();
      const m=s.match(/user\n([\s\S]*?)(?:\nassistant|$)/i);
      if(m) return m[1].trim();
      return s.replace(/^(system|user|assistant)\n/ig,'').trim();
    }

    function formatCodeBlocks(text){
      const regex=/```([a-zA-Z0-9_]+)?\n([\s\S]*?)```/g;
      return text.replace(regex,(match,lang,code)=>{
        code=code.replace(/</g,"&lt;").replace(/>/g,"&gt;");
        return `<pre><code class="language-python">${code}</code></pre>`;
      });
    }

    function startQuiz(){
      const qcount=parseInt(qcountInput.value,10);
      if(!(qcount>=1 && qcount<=240)){alert("Choose between 1-240");return;}
      const n=questions.length;const idxs=Array.from({length:n},(_,i)=>i);
      for(let i=n-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[idxs[i],idxs[j]]=[idxs[j],idxs[i]];}
      chosenIndices=idxs.slice(0,qcount);
      userChoices=Array.from({length:questions.length},()=>[null,null,null]);
      rounds=[];
      chosenIndices.forEach(qi=>{[0,1,2].forEach(ai=>{rounds.push({qIndex:qi,aIndex:ai});});});
      for(let i=rounds.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[rounds[i],rounds[j]]=[rounds[j],rounds[i]];}
      totalRounds=rounds.length;currentRound=0;
      document.getElementById("topbar").classList.add("hidden");
      document.getElementById("quizArea").classList.remove("hidden");
      renderRound();
    }

    function renderRound(){
      const r=rounds[currentRound];
      document.getElementById("progress").textContent=`Round ${currentRound+1} / ${totalRounds}`;
      const qtext=extractQuestion(escapeDollar(questions[r.qIndex]));
      document.getElementById("qtext").innerHTML=qtext?formatCodeBlocks(escapeDollar(qtext)):"<em>(empty)</em>";
      const ans=answers[r.qIndex][r.aIndex];
      const row=document.getElementById("answersRow");row.innerHTML="";
      const card=document.createElement("div");card.className="answer-card";
      const at=document.createElement("div");at.className="ans-text";at.innerHTML=formatCodeBlocks(ans).replace(/\n/g,"<br>");
      const controls=document.createElement("div");controls.className="ans-controls";
      const btnTrust=document.createElement("button");btnTrust.className="btn-choose";btnTrust.textContent="Trust";
      const btnNot=document.createElement("button");btnNot.className="btn-choose";btnNot.textContent="Don't Trust";
      btnTrust.onclick=()=>{selectAnswer(1,btnTrust,btnNot,r)};
      btnNot.onclick=()=>{selectAnswer(0,btnNot,btnTrust,r)};
      controls.appendChild(btnTrust);controls.appendChild(btnNot);
      card.appendChild(at);card.appendChild(controls);
      row.appendChild(card);
      resetTimer();
      document.getElementById("nextBtn").disabled=true;
      setTimeout(()=>MathJax.typesetPromise(),100);
    }

    function selectAnswer(val,btnThis,btnOther,r){
      userChoices[r.qIndex][r.aIndex]=val;
      btnThis.classList.add("selected",val===1?"trust":"not");
      btnOther.classList.remove("selected","trust","not");
      document.getElementById("nextBtn").disabled=false;
    }

    function resetTimer(){
      clearInterval(timerInterval);timeLeft=20;
      document.getElementById("timer").textContent="Time Left: "+timeLeft+"s";
      timerInterval=setInterval(()=>{
        timeLeft--;document.getElementById("timer").textContent="Time Left: "+timeLeft+"s";
        if(timeLeft<=0){clearInterval(timerInterval);autoTimeout();}
      },1000);
    }

    function autoTimeout(){
      const r=rounds[currentRound];
      if(userChoices[r.qIndex][r.aIndex]==null) userChoices[r.qIndex][r.aIndex]=-1;
      goNext(true);
    }

    function goNext(){
      clearInterval(timerInterval);
      currentRound++;
      if(currentRound<totalRounds){renderRound();}
      else{finishAndDownload();}
    }

    function finishAndDownload(){
      const out={dataset:"T_total",chosen_indices:chosenIndices,entries:[]};
      for(let i=0;i<chosenIndices.length;i++){
        const idx=chosenIndices[i];
        out.entries.push({index:idx,question:questions[idx],answers:answers[idx],choices:userChoices[idx]});
      }
      const blob=new Blob([JSON.stringify(out,null,2)],{type:"application/json"});
      const url=URL.createObjectURL(blob);
      const a=document.createElement("a");
      a.href=url;
      a.download=`T_total_results_${Date.now()}.json`;

      document.body.appendChild(a);
      a.click();                      
      document.body.removeChild(a);   
      URL.revokeObjectURL(url);
      alert("All done — JSON downloaded.");
    }

    startBtn.onclick=()=>{loadData().then(startQuiz)};
    resetBtn.onclick=()=>location.reload();
    document.getElementById("nextBtn").onclick=()=>goNext(false);
  </script>

  <script>hljs.highlightAll();</script>
</body>
</html>
